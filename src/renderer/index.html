<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Froggy RAG MCP</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <h1>Froggy RAG MCP</h1>
      <div style="display: flex; gap: 10px; align-items: center;">
        <button class="btn-help" id="settings-btn" title="Settings">‚öôÔ∏è</button>
        <button class="btn-help" id="help-btn" title="Help">?</button>
      </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Left Tree Panel -->
      <div class="tree-panel" id="treePanel">
        <div class="tree-container">
          <div class="tree-item" data-node="ingestion">
            <span class="tree-icon">üìÅ</span>
            <span class="tree-label">Ingestion</span>
            <span class="tree-expander">‚ñº</span>
          </div>
          <div class="tree-children" data-parent="ingestion">
            <div class="tree-item" data-node="files">
              <span class="tree-icon">üìÑ</span>
              <span class="tree-label">Files</span>
            </div>
            <div class="tree-item" data-node="directories">
              <span class="tree-icon">üìÇ</span>
              <span class="tree-label">Directories</span>
            </div>
          </div>
          
          <div class="tree-item" data-node="vector-store">
            <span class="tree-icon">üóÑÔ∏è</span>
            <span class="tree-label">Vector Store</span>
          </div>
          
          <div class="tree-item" data-node="search">
            <span class="tree-icon">üîç</span>
            <span class="tree-label">Search</span>
          </div>
          
          <div class="tree-item" data-node="server">
            <span class="tree-icon">üñ•Ô∏è</span>
            <span class="tree-label">Server</span>
          </div>
        </div>
      </div>

      <!-- Splitter -->
      <div class="splitter" id="splitter"></div>

      <!-- Content Panel -->
      <div class="content-panel" id="contentPanel">
        <!-- Files Canvas -->
        <div class="canvas" id="files-canvas" style="display: none;">
          <h2>Files</h2>
          <div class="toolbar">
            <button class="btn btn-primary" id="add-file-btn">Add File</button>
            <input type="file" id="file-input" multiple style="display: none;" accept=".txt,.pdf,.docx,.xlsx,.csv">
          </div>
          <div class="grid-container" id="files-grid">
            <table class="data-grid">
              <thead>
                <tr>
                  <th>File Path</th>
                  <th>Status</th>
                  <th>Active</th>
                  <th>Watch</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="files-tbody"></tbody>
            </table>
          </div>
        </div>

        <!-- Directories Canvas -->
        <div class="canvas" id="directories-canvas" style="display: none;">
          <h2>Directories</h2>
          <div class="toolbar">
            <button class="btn btn-primary" id="add-directory-btn">Add Directory</button>
            <input type="file" id="directory-input" webkitdirectory style="display: none;">
          </div>
          <div class="grid-container" id="directories-grid">
            <table class="data-grid">
              <thead>
                <tr>
                  <th>Directory Path</th>
                  <th>Recursive</th>
                  <th>Active</th>
                  <th>Watch</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="directories-tbody"></tbody>
            </table>
          </div>
        </div>

        <!-- Vector Store Canvas -->
        <div class="canvas" id="vector-store-canvas" style="display: none;">
          <h2>Vector Store</h2>
          <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 4px; border: 1px solid #e0e0e0;">
            <button id="regenerate-vector-store-btn" class="btn btn-danger">Regenerate Vector Store</button>
            <p style="margin: 10px 0 0 0; font-size: 12px; color: #757575;">This will clear the entire vector store and re-index all files from your current files/directories settings.</p>
          </div>
          <div class="stats-bar" id="vector-store-stats"></div>
          <div class="grid-container">
            <div class="documents-panel">
              <h3>Documents</h3>
              <table class="data-grid">
                <thead>
                  <tr>
                    <th>File Name</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Last Updated</th>
                    <th>Chunks</th>
                  </tr>
                </thead>
                <tbody id="documents-tbody"></tbody>
              </table>
            </div>
            <div class="chunks-panel" id="chunks-panel" style="display: none;">
              <h3>Chunks</h3>
              <table class="data-grid">
                <thead>
                  <tr>
                    <th>Index</th>
                    <th>Preview</th>
                    <th>Last Updated</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="chunks-tbody"></tbody>
              </table>
            </div>
          </div>
          <!-- Chunk Detail Modal -->
          <div class="modal-overlay" id="chunk-modal-overlay" style="display: none;">
            <div class="modal-dialog" id="chunk-modal">
              <div class="modal-header">
                <h3>Chunk Details</h3>
                <button class="modal-close" onclick="closeChunkDetail()">&times;</button>
              </div>
              <div class="modal-body">
                <div class="chunk-content-section">
                  <h4>Content</h4>
                  <div class="chunk-content-text" id="chunk-content"></div>
                </div>
                <div class="chunk-metadata-section">
                  <h4>Metadata</h4>
                  <div class="chunk-metadata-grid" id="chunk-metadata"></div>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeChunkDetail()">Close</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Search Canvas -->
        <div class="canvas" id="search-canvas" style="display: none; position: relative;">
          <h2>Search</h2>
          <div class="search-container">
            <div class="search-box" style="position: relative;">
              <input type="text" id="search-input" placeholder="Enter search query..." autocomplete="off" />
              <button class="btn btn-primary" id="search-btn">Search</button>
            </div>
            <div class="mru-container" id="mru-container">
              <h4>Recent Searches</h4>
              <div id="mru-list"></div>
            </div>
          </div>
          <div class="search-loading-spinner" id="search-loading-spinner">
            <div class="spinner"></div>
            <div class="search-loading-text">Searching...</div>
            <div class="search-timer" id="search-timer">0.0s</div>
            <button class="btn btn-secondary search-cancel-btn" id="search-cancel-btn">Cancel</button>
          </div>
          <div class="search-results-container" id="search-results-container" style="display: none;">
            <div class="search-results" id="search-results">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="margin: 0;">Results</h3>
                <div id="search-time-display" style="font-size: 13px; color: #757575; font-style: italic;"></div>
              </div>
              <div class="search-options" style="margin-bottom: 10px;">
                <label for="search-algorithm">Algorithm: </label>
                <select id="search-algorithm" style="padding: 5px; margin-left: 5px;">
                  <option value="hybrid">Hybrid (BM25 + Vector)</option>
                  <option value="bm25">BM25</option>
                  <option value="tfidf">TF-IDF</option>
                  <option value="vector">Vector Similarity</option>
                </select>
              </div>
              <table class="data-grid">
                <thead>
                  <tr>
                    <th>Score</th>
                    <th>Algorithm</th>
                    <th>Document</th>
                    <th>Preview</th>
                  </tr>
                </thead>
                <tbody id="search-results-tbody"></tbody>
              </table>
            </div>
            <div class="horizontal-splitter" id="search-horizontal-splitter"></div>
            <div class="chunk-detail" id="search-chunk-detail">
              <h3>Chunk Details</h3>
              <div class="chunk-detail-content">
                <div class="chunk-detail-text" id="search-chunk-content"></div>
                <div class="vertical-splitter" id="chunk-detail-vertical-splitter"></div>
                <div class="chunk-detail-metadata" id="search-chunk-metadata"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Server Canvas -->
        <div class="canvas" id="server-canvas" style="display: none;">
          <h2>Server</h2>
          <div class="server-controls">
            <div class="server-status" id="server-status">
              <span>Status: <span id="server-status-text">Stopped</span></span>
            </div>
            <div class="server-actions">
              <button class="btn btn-primary" id="start-server-btn">Start Server</button>
              <button class="btn btn-danger" id="stop-server-btn" disabled>Stop Server</button>
              <button class="btn btn-secondary" id="self-test-btn" disabled>Self Test</button>
            </div>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0; font-size: 13px; color: #757575;">
              <p style="margin: 0;">Configure server settings (port, auto-start) in the <strong>Settings</strong> menu (‚öôÔ∏è).</p>
            </div>
          </div>
          <div class="server-endpoints" id="server-endpoints" style="display: none;">
            <h3>Server URLs</h3>
            <div class="endpoints-info">
              <div class="server-urls">
                <div class="server-url-item">
                  <div class="url-label">
                    <strong>REST API URL:</strong>
                  </div>
                  <div class="url-value-container">
                    <span class="url-value" id="rest-url-value"></span>
                    <button class="btn btn-secondary btn-copy" data-url-type="rest" title="Copy to clipboard">
                      üìã Copy
                    </button>
                  </div>
                </div>
                <div class="server-url-item">
                  <div class="url-label">
                    <strong>MCP Protocol URL:</strong>
                  </div>
                  <div class="url-value-container">
                    <span class="url-value" id="mcp-url-value"></span>
                    <button class="btn btn-secondary btn-copy" data-url-type="mcp" title="Copy to clipboard">
                      üìã Copy
                    </button>
                  </div>
                </div>
              </div>
              <div class="endpoints-list">
                <h4>REST API Endpoints:</h4>
                <table class="endpoints-table">
                  <thead>
                    <tr>
                      <th>Method</th>
                      <th>Endpoint</th>
                      <th>Description</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="endpoints-tbody"></tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="server-logs" id="server-logs">
            <h3>Logs</h3>
            <div class="log-container" id="log-container"></div>
          </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal-overlay" id="settings-modal-overlay" style="display: none;">
          <div class="modal-dialog" id="settings-modal" style="max-width: 1000px; width: 90%; height: 85vh; display: flex; flex-direction: column;">
            <div class="modal-header">
              <h3>Settings</h3>
              <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
            </div>
            <div style="display: flex; flex: 1; overflow: hidden;">
              <!-- Settings Sidebar -->
              <div class="settings-sidebar" style="width: 200px; border-right: 1px solid #e0e0e0; background: #f9f9f9; overflow-y: auto; flex-shrink: 0;">
                <div class="settings-page-item active" data-settings-page="chunking" style="padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #e0e0e0; transition: background 0.2s;">
                  <span style="font-weight: 500; color: #424242;">Chunking</span>
                </div>
                <div class="settings-page-item" data-settings-page="retrieval" style="padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #e0e0e0; transition: background 0.2s;">
                  <span style="font-weight: 500; color: #424242;">Retrieval</span>
                </div>
                <div class="settings-page-item" data-settings-page="metadata-filtering" style="padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #e0e0e0; transition: background 0.2s;">
                  <span style="font-weight: 500; color: #424242;">Metadata & Filtering</span>
                </div>
                <div class="settings-page-item" data-settings-page="general" style="padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #e0e0e0; transition: background 0.2s;">
                  <span style="font-weight: 500; color: #424242;">General</span>
                </div>
                <div class="settings-page-item" data-settings-page="server" style="padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #e0e0e0; transition: background 0.2s;">
                  <span style="font-weight: 500; color: #424242;">Server</span>
                </div>
              </div>
              <!-- Settings Content -->
              <div class="settings-content" style="flex: 1; overflow-y: auto; padding: 20px;">
                <!-- Chunking Settings Page -->
                <div class="settings-page" id="settings-page-chunking" style="display: block;">
                  <h3 style="margin: 0 0 20px 0; font-size: 20px; font-weight: 600; color: #2c3e50;">Chunking Settings</h3>
                  
                  <div class="chunking-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Chunk Size</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-chunk-size-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Chunk Size:</label>
                        <input type="number" id="settings-chunk-size-input" min="100" max="10000" step="100" value="1000" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">characters</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      <strong>Typical:</strong> 256‚Äì1024. Smaller = more precise but more queries; larger = more context but fuzzier matches.
                    </p>
                  </div>

                  <div class="chunking-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Chunk Overlap</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-chunk-overlap-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Overlap:</label>
                        <input type="number" id="settings-chunk-overlap-input" min="0" max="5000" step="50" value="200" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">characters</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      <strong>Typical:</strong> 32‚Äì128. Helps avoid splitting important sentences/sections across chunks.
                    </p>
                  </div>

                  <div class="chunking-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Minimum Chunk Size</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-min-chunk-chars-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Min Chunk Chars:</label>
                        <input type="number" id="settings-min-chunk-chars-input" min="0" max="500" step="10" value="50" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">characters</span>
                      </div>
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-min-chunk-tokens-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Min Chunk Tokens:</label>
                        <input type="number" id="settings-min-chunk-tokens-input" min="0" max="200" step="5" value="10" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">tokens</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      Skip tiny/low-signal chunks. Chunks below these thresholds will be filtered out.
                    </p>
                  </div>

                  <div class="chunking-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Max Chunks Per Document</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-max-chunks-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Max Chunks:</label>
                        <input type="number" id="settings-max-chunks-input" min="0" max="10000" step="100" value="0" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">(0 = unlimited)</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      Helps avoid one huge doc dominating the index. Set to 0 for unlimited chunks per document.
                    </p>
                  </div>

                  <div class="chunking-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Embedding Model</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                        <label for="settings-embedding-model-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Model:</label>
                        <select id="settings-embedding-model-input" style="flex: 1; max-width: 400px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                          <option value="Xenova/all-MiniLM-L6-v2">Xenova/all-MiniLM-L6-v2 (Default)</option>
                          <option value="text-embedding-3-large">text-embedding-3-large</option>
                          <option value="nomic-embed-text">nomic-embed-text</option>
                          <option value="gte-large">gte-large</option>
                        </select>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      Select the embedding model to use. Examples: "text-embedding-3-large", "nomic-embed-text", "gte-large".
                    </p>
                  </div>

                  <div class="chunking-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Normalize Embeddings</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="settings-normalize-embeddings-input" checked style="width: 18px; height: 18px; cursor: pointer;" />
                        <label for="settings-normalize-embeddings-input" style="font-weight: 500; color: #616161; cursor: pointer;">L2-normalize vectors</label>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      Whether to L2-normalize vectors. Usually true for cosine similarity.
                    </p>
                  </div>

                  <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                    <button id="settings-save-chunking-settings-btn" class="btn btn-primary">Save Settings</button>
                  </div>
                  
                  <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                    <p style="margin: 0; font-size: 13px; color: #757575;">These settings will be applied to newly ingested documents.</p>
                  </div>
                </div>

                <!-- Retrieval Settings Page -->
                <div class="settings-page" id="settings-page-retrieval" style="display: none;">
                  <h3 style="margin: 0 0 20px 0; font-size: 20px; font-weight: 600; color: #2c3e50;">Retrieval Settings</h3>
                  
                  <div class="retrieval-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Top K</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-top-k-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Top K:</label>
                        <input type="number" id="settings-top-k-input" min="1" max="100" step="1" value="10" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">neighbors</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      <strong>Typical:</strong> 5‚Äì30. How many neighbors to return from the search.
                    </p>
                  </div>

                  <div class="retrieval-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Score Threshold</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-score-threshold-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Threshold:</label>
                        <input type="number" id="settings-score-threshold-input" min="0" max="1" step="0.01" value="0" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">(0 = no threshold)</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      Drop results below a minimum similarity. Useful to avoid hallucinating when nothing is relevant.
                    </p>
                  </div>

                  <div class="retrieval-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Max Returned Chunks Per Document</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-max-chunks-per-doc-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Max Chunks:</label>
                        <input type="number" id="settings-max-chunks-per-doc-input" min="0" max="100" step="1" value="0" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">(0 = unlimited)</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      Avoid multiple very-similar chunks from the same doc. E.g. max_chunks_per_doc = 3.
                    </p>
                  </div>

                  <div class="retrieval-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Group by Document / Return Full Documents</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="settings-group-by-doc-input" style="width: 18px; height: 18px; cursor: pointer;" />
                        <label for="settings-group-by-doc-input" style="font-weight: 500; color: #616161; cursor: pointer;">Group results by document</label>
                      </div>
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="settings-return-full-docs-input" style="width: 18px; height: 18px; cursor: pointer;" />
                        <label for="settings-return-full-docs-input" style="font-weight: 500; color: #616161; cursor: pointer;">Return full documents with scores</label>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      Whether to group results by document and/or return full documents with scores.
                    </p>
                  </div>

                  <div class="retrieval-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Max Context Tokens</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-max-context-tokens-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Max Tokens:</label>
                        <input type="number" id="settings-max-context-tokens-input" min="0" max="100000" step="100" value="0" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">(0 = unlimited)</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      How many tokens you're willing to feed into the LLM; you can use this to cap top_k dynamically.
                    </p>
                  </div>

                  <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                    <button id="settings-save-retrieval-settings-btn" class="btn btn-primary">Save Settings</button>
                  </div>
                  
                  <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                    <p style="margin: 0; font-size: 13px; color: #757575;">These settings will be applied to search queries.</p>
                  </div>
                </div>

                <!-- General Settings Page -->
                <div class="settings-page" id="settings-page-general" style="display: none;">
                  <h3 style="margin: 0 0 20px 0; font-size: 20px; font-weight: 600; color: #2c3e50;">General Settings</h3>
                  
                  <div class="general-settings-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Window Behavior</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="settings-minimize-to-tray-input" style="width: 18px; height: 18px; cursor: pointer;" />
                        <label for="settings-minimize-to-tray-input" style="font-weight: 500; color: #616161; cursor: pointer;">Minimize to system tray</label>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      When enabled, minimizing or closing the window will hide it to the system tray instead of closing the application. You can restore the window by clicking the tray icon.
                    </p>
                  </div>

                  <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                    <button id="settings-save-general-settings-btn" class="btn btn-primary">Save Settings</button>
                  </div>
                </div>

                <!-- Server Settings Page -->
                <div class="settings-page" id="settings-page-server" style="display: none;">
                  <h3 style="margin: 0 0 20px 0; font-size: 20px; font-weight: 600; color: #2c3e50;">Server Settings</h3>
                  
                  <div class="server-settings-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Server Port</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-server-port-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Port:</label>
                        <input type="number" id="settings-server-port-input" min="1024" max="65535" step="1" value="3000" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      The port number on which the MCP server will listen for connections. Default is 3000.
                    </p>
                  </div>

                  <div class="server-settings-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Auto-Start Server</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="settings-auto-start-server-input" style="width: 18px; height: 18px; cursor: pointer;" />
                        <label for="settings-auto-start-server-input" style="font-weight: 500; color: #616161; cursor: pointer;">Automatically start server when app starts</label>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      When enabled, the MCP server will automatically start when the application launches using the configured port.
                    </p>
                  </div>

                  <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                    <button id="settings-save-server-settings-btn" class="btn btn-primary">Save Settings</button>
                  </div>
                  
                  <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                    <p style="margin: 0; font-size: 13px; color: #757575;">These settings will be applied when starting the server.</p>
                  </div>
                </div>

                <!-- Metadata & Filtering Settings Page -->
                <div class="settings-page" id="settings-page-metadata-filtering" style="display: none;">
                  <h3 style="margin: 0 0 20px 0; font-size: 20px; font-weight: 600; color: #2c3e50;">Metadata & Filtering Settings</h3>
                  
                  <div class="metadata-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Time Range / Since</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-since-days-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Since Days:</label>
                        <input type="number" id="settings-since-days-input" min="0" max="3650" step="1" value="0" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">days (0 = no filter)</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      Prioritize documents created or updated within the specified number of days. Set to 0 to disable time-based filtering.
                    </p>
                  </div>

                  <div class="metadata-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Time Decay</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="settings-time-decay-enabled-input" style="width: 18px; height: 18px; cursor: pointer;" />
                        <label for="settings-time-decay-enabled-input" style="font-weight: 500; color: #616161; cursor: pointer;">Enable time decay</label>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      When enabled, multiply similarity scores by a time-based decay factor to prioritize fresher documents.
                    </p>
                  </div>

                  <div class="metadata-controls" style="padding: 20px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: #424242;">Time Decay Half Life</h4>
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="settings-time-decay-half-life-input" style="font-weight: 500; color: #616161; white-space: nowrap;">Half Life Days:</label>
                        <input type="number" id="settings-time-decay-half-life-input" min="1" max="3650" step="1" value="30" style="width: 100px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;" />
                        <span style="color: #757575; font-size: 13px;">days</span>
                      </div>
                    </div>
                    <p style="margin: 0; font-size: 12px; color: #757575; line-height: 1.5;">
                      The number of days after which a document's similarity score is reduced by half. Documents older than this will have progressively lower scores.
                    </p>
                  </div>

                  <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                    <button id="settings-save-metadata-filtering-settings-btn" class="btn btn-primary">Save Settings</button>
                  </div>
                  
                  <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                    <p style="margin: 0; font-size: 13px; color: #757575;">These settings will be applied to search queries.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" onclick="closeSettingsModal()">Close</button>
            </div>
          </div>
        </div>

        <!-- Help/Usage Modal -->
        <div class="modal-overlay" id="help-modal-overlay" style="display: none;">
          <div class="modal-dialog" id="help-modal" style="max-width: 900px;">
            <div class="modal-header">
              <h3>User Guide</h3>
              <button class="modal-close" onclick="closeHelpModal()">&times;</button>
            </div>
            <div class="modal-body">
              <div class="markdown-viewer" id="markdown-content"></div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" onclick="closeHelpModal()">Close</button>
            </div>
          </div>
        </div>

        <!-- Endpoint Test Modal -->
        <div class="modal-overlay" id="endpoint-test-modal" style="display: none;">
          <div class="modal-dialog" style="max-width: 600px;">
            <div class="modal-header">
              <h3 id="test-modal-title">Send Request</h3>
              <button class="modal-close" onclick="closeEndpointTestModal()">&times;</button>
            </div>
            <div class="modal-body">
              <!-- Request Form View -->
              <div id="test-modal-request-view">
                <div style="margin-bottom: 15px;">
                  <strong>Method:</strong> <span id="test-modal-method"></span><br>
                  <strong>Endpoint:</strong> <span id="test-modal-endpoint" style="font-family: monospace;"></span>
                </div>
                <div id="test-modal-preview-section" style="margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0;">
                  <strong>Request Preview:</strong>
                  <div id="test-modal-preview-content" style="margin-top: 8px; font-family: 'Courier New', monospace; font-size: 12px; color: #424242;"></div>
                </div>
                <div id="test-modal-params-section" style="display: none;">
                  <label><strong>Parameters:</strong></label>
                  <div id="test-modal-params-inputs" style="margin-top: 10px;"></div>
                </div>
                <div id="test-modal-payload-section" style="display: none;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <label><strong>Request Payload (JSON):</strong></label>
                    <button class="btn btn-secondary" id="reset-payload-btn" onclick="resetEndpointTestPayload()" style="padding: 4px 12px; font-size: 12px;">Reset</button>
                  </div>
                  <textarea id="test-modal-payload" style="width: 100%; height: 200px; margin-top: 10px; padding: 10px; font-family: 'Courier New', monospace; border: 1px solid #ccc; border-radius: 4px; resize: vertical;"></textarea>
                </div>
                <div id="test-modal-params-reset-section" style="display: none; margin-top: 10px;">
                  <button class="btn btn-secondary" id="reset-params-btn" onclick="resetEndpointTestParams()" style="padding: 4px 12px; font-size: 12px;">Reset Parameters</button>
                </div>
              </div>
              
              <!-- Response View -->
              <div id="test-modal-response-view" style="display: none;">
                <div style="margin-bottom: 15px;">
                  <strong>Method:</strong> <span id="test-modal-response-method"></span><br>
                  <strong>Endpoint:</strong> <span id="test-modal-response-endpoint" style="font-family: monospace;"></span>
                </div>
                <div id="test-modal-result">
                  <strong>Response:</strong>
                  <div id="test-modal-result-content" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px; max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; white-space: pre-wrap;"></div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" id="test-endpoint-send-btn" onclick="sendEndpointTest()">Send</button>
              <button class="btn btn-secondary" id="test-endpoint-cancel-btn" onclick="closeEndpointTestModal()">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>


